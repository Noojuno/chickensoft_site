"use strict";(self.webpackChunkchickensoft_site=self.webpackChunkchickensoft_site||[]).push([[633],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>m});var a=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function p(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),l=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=l(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,d=p(e,["components","mdxType","originalType","parentName"]),u=l(n),m=o,h=u["".concat(s,".").concat(m)]||u[m]||c[m]||i;return n?a.createElement(h,r(r({ref:t},d),{},{components:n})):a.createElement(h,r({ref:t},d))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=u;var p={};for(var s in t)hasOwnProperty.call(t,s)&&(p[s]=t[s]);p.originalType=e,p.mdxType="string"==typeof e?e:o,r[1]=p;for(var l=2;l<i;l++)r[l]=n[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},8124:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>f,frontMatter:()=>i,metadata:()=>p,toc:()=>l});var a=n(7462),o=(n(7294),n(3905));const i={title:"\ud83d\udd2e SuperNodes",image:"./header.jpg",sidebar_position:3},r=void 0,p={unversionedId:"super_nodes/index",id:"super_nodes/index",title:"\ud83d\udd2e SuperNodes",description:"[SuperNodes] is a C# source generator that gives superpowers to Godot node scripts.",source:"@site/docs/super_nodes/index.md",sourceDirName:"super_nodes",slug:"/super_nodes/",permalink:"/docs/super_nodes/",draft:!1,editUrl:"https://github.com/chickensoft-games/chickensoft_site/tree/main/docs/super_nodes/index.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"\ud83d\udd2e SuperNodes",image:"./header.jpg",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"\ud83c\udfc1 Getting Started",permalink:"/docs/setup"},next:{title:"\ud83d\udce6 Installation",permalink:"/docs/super_nodes/installation"}},s={image:n(4467).Z},l=[{value:"\ud83d\udd2e Superpowers for C# Scripts",id:"-superpowers-for-c-scripts",level:2},{value:"\ud83d\udd18 SuperNodes",id:"-supernodes",level:2},{value:"\ud83d\udd0b PowerUps",id:"-powerups",level:2},{value:"\ud83e\ude84 Beneath the Magic",id:"-beneath-the-magic",level:2}],d=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.kt)("div",t)},c=d("FancyImage"),u=d("Details"),m=d("Admonition"),h={toc:l};function f(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://github.com/chickensoft-games/SuperNodes"},"SuperNodes")," is a C# source generator that gives superpowers to Godot node scripts."),(0,o.kt)(c,{alt:"",src:"/img/chickensoft/super_nodes.svg",widthOverride:"200px",mdxType:"FancyImage"}),(0,o.kt)("h2",{id:"-superpowers-for-c-scripts"},"\ud83d\udd2e Superpowers for C# Scripts"),(0,o.kt)("p",null,"Many programming languages allow you to combine the contents of one class with another class using features such as ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Mixin"},(0,o.kt)("inlineCode",{parentName:"a"},"mixins")),", ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Trait_(computer_programming)"},(0,o.kt)("inlineCode",{parentName:"a"},"traits"))," or even ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Template_(C++)"},(0,o.kt)("inlineCode",{parentName:"a"},"templates"))," and ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Macro_(computer_science)"},(0,o.kt)("inlineCode",{parentName:"a"},"macros")),"."),(0,o.kt)("p",null,"C# has no such feature. \ud83d\ude22"),(0,o.kt)(u,{summary:(0,o.kt)("summary",null,"Wait! What about ",(0,o.kt)("i",null,"Default Interface Implementations?")),mdxType:"Details"},(0,o.kt)("p",null,"You might be wondering about C#'s ",(0,o.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-8.0/default-interface-methods"},"default interface implementations")," feature. Unfortunately, default interface implementations cannot be used to add instance data to a class."),(0,o.kt)("p",null,"That is, you can't add fields to a class using default interface implementations (and by extent, you can't add property implementations since they use fields under-the-hood)."),(0,o.kt)("p",null,"Here's what ",(0,o.kt)("a",{parentName:"p",href:"https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/proposals/csharp-8.0/default-interface-methods#detailed-design"},"Microsoft has to say about it"),":"),(0,o.kt)(m,{type:"caution",mdxType:"Admonition"},(0,o.kt)("p",null,"Interfaces may not contain instance state. While static fields are now permitted, instance fields are not permitted in interfaces. Instance auto-properties are not supported in interfaces, as they would implicitly declare a hidden field."))),(0,o.kt)("p",null,"To make up for these shortcomings in C#, the SuperNodes generator allows you to turn any ordinary Godot script into a ",(0,o.kt)("inlineCode",{parentName:"p"},"SuperNode")," by adding a ",(0,o.kt)("inlineCode",{parentName:"p"},"[SuperNode]")," attribute to it. Turning a node into a SuperNode allows you to:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u2705 Apply PowerUps (essentially mixins for C#) to your node scripts."),(0,o.kt)("li",{parentName:"ul"},"\u2705 Use third-party source generators alongside Godot's official source generators."),(0,o.kt)("li",{parentName:"ul"},"\u2705 Get and set the value of script properties and fields at runtime, without using reflection."),(0,o.kt)("li",{parentName:"ul"},"\u2705 Examine the attributes and types of script properties and fields at runtime, without using reflection."),(0,o.kt)("li",{parentName:"ul"},"\u2705 Inspect SuperNodes across assemblies using the shared runtime types."),(0,o.kt)("li",{parentName:"ul"},"\u2705 Utilize PowerUps from source-only nuget packages.")),(0,o.kt)("p",null,"Making a PowerUp is also easy: just mark another script class with a ",(0,o.kt)("inlineCode",{parentName:"p"},"[PowerUp]")," attribute and then apply that PowerUp to a SuperNode."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},'namespace SimpleExample;\n\nusing Godot;\nusing SuperNodes.Types;\n\n[SuperNode(typeof(ExamplePowerUp))]\npublic partial class ExampleNode : Node {\n  public override partial void _Notification(int what);\n\n  public void OnReady() => SomeMethod();\n\n  public void OnProcess(double delta) => SomeMethod();\n\n  public void SomeMethod() {\n    var d = GetProcessDeltaTime();\n    if (LastNotification == NotificationReady) {\n      GD.Print("We were getting ready.");\n    }\n    else if (LastNotification == NotificationProcess) {\n      GD.Print("We were processing a frame.");\n    }\n  }\n}\n\n// A PowerUp that logs some of the main lifecycle events of a node.\n[PowerUp]\npublic partial class ExamplePowerUp : Node {\n  public long LastNotification { get; private set; }\n\n  public void OnExamplePowerUp(int what) {\n    switch ((long)what) {\n      case NotificationReady:\n        GD.Print("PowerUp is ready!");\n        break;\n      case NotificationEnterTree:\n        GD.Print("I\'m in the tree!");\n        break;\n      case NotificationExitTree:\n        GD.Print("I\'m out of the tree!");\n        break;\n      default:\n        break;\n    }\n    LastNotification = what;\n  }\n}\n')),(0,o.kt)("p",null,"The script above defines a SuperNode named ",(0,o.kt)("inlineCode",{parentName:"p"},"ExampleNode")," that applies the PowerUp called ",(0,o.kt)("inlineCode",{parentName:"p"},"ExamplePowerUp"),"."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"ExamplePowerUp")," tracks the last lifecycle event that has occurred in the node, allowing the ",(0,o.kt)("inlineCode",{parentName:"p"},"ExampleNode")," to access the PowerUp's ",(0,o.kt)("inlineCode",{parentName:"p"},"LastNotification")," property as if it were its own, even though ",(0,o.kt)("inlineCode",{parentName:"p"},"ExampleNode")," didn't declare such a property."),(0,o.kt)("p",null,"Because of the magic of source generators, there are no syntax errors. Everything compiles correctly and with static typing support!"),(0,o.kt)("h2",{id:"-supernodes"},"\ud83d\udd18 SuperNodes"),(0,o.kt)("p",null,"We'll break the example above into a few smaller pieces to explain what's happening."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"[SuperNode(typeof(ExamplePowerUp))]\n")),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"[SuperNode]")," attribute can be given a list of parameters. Each parameter can specify a PowerUp or a string that represents a lifecycle method hook (more on those later). PowerUps are specified by passing the type of the PowerUp class, so we use ",(0,o.kt)("inlineCode",{parentName:"p"},"typeof")," to identify the type of the ",(0,o.kt)("inlineCode",{parentName:"p"},"ExamplePowerUp"),". It's fast, easy, and ",(0,o.kt)("strong",{parentName:"p"},"works at compile-time"),"!"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"public partial class ExampleNode : Node {\n")),(0,o.kt)("p",null,"You probably recognize this from writing C# scripts in Godot. It's just an ordinary Godot script class!"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"  public override partial void _Notification(int what);\n")),(0,o.kt)("p",null,"Unfortunately, all ",(0,o.kt)("inlineCode",{parentName:"p"},"[SuperNode]")," scripts have to include this extremely verbose partial method signature."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"If you forget to add the ",(0,o.kt)("inlineCode",{parentName:"p"},"public override partial void _Notification(int what);")," to your SuperNode script, you'll get a nice little message from the SuperNodes generator reminding you to do just that with the correct method signature (because we all know you probably don't want to memorize that).")),(0,o.kt)("p",null,"For SuperNodes to work, it has to be able to generate an implementation for Godot's ",(0,o.kt)("inlineCode",{parentName:"p"},"_Notification")," method. Implementing the lifecycle method allows SuperNodes to invoke PowerUps and lifecycle hooks in response to any lifecycle event that occurs in a Godot node."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"If you need your script to also implement ",(0,o.kt)("inlineCode",{parentName:"p"},"_Notification"),", just declare a method with the signature ",(0,o.kt)("inlineCode",{parentName:"p"},"public void OnNotification(int what)")," and SuperNodes will make sure it's called whenever ",(0,o.kt)("inlineCode",{parentName:"p"},"_Notification")," is called.")),(0,o.kt)("p",null,"You may have noticed that instead of overriding ",(0,o.kt)("inlineCode",{parentName:"p"},"_Ready")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"_Process"),", the SuperNode uses methods named ",(0,o.kt)("inlineCode",{parentName:"p"},"OnReady")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"OnProcess")," that have otherwise identical signatures to their Godot counterparts. The SuperNodes generator will look inside SuperNodes for methods named ",(0,o.kt)("inlineCode",{parentName:"p"},"On{LifecycleHandler}")," for each Godot lifecycle notification (there are quite a few) and call the handler with the same name, prefixed with the word ",(0,o.kt)("inlineCode",{parentName:"p"},"On"),"."),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"See the ",(0,o.kt)("a",{parentName:"p",href:"./lifecycle-handlers"},"full list of lifecycle handlers")," to determine which methods you can implement!")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"public partial class ExampleNode : Node {\n  public override partial void _Notification(int what);\n\n  public void OnReady() => SomeMethod();\n\n  public void OnProcess(double delta) => SomeMethod();\n")),(0,o.kt)("h2",{id:"-powerups"},"\ud83d\udd0b PowerUps"),(0,o.kt)("p",null,"The PowerUp in the example above is also just an ordinary script class that extends a Godot node. The only new piece appears to be the ",(0,o.kt)("inlineCode",{parentName:"p"},"[PowerUp]")," attribute, but there's actually something hiding here."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},'[PowerUp]\npublic partial class ExamplePowerUp : Node {\n  public long LastNotification { get; private set; }\n\n  public void OnExamplePowerUp(int what) {\n    switch ((long)what) {\n      case NotificationReady:\n        GD.Print("PowerUp is ready!");\n        break;\n\n        // ...\n')),(0,o.kt)("p",null,"When making PowerUps, SuperNodes will check to see if the PowerUp declares a method with the name ",(0,o.kt)("inlineCode",{parentName:"p"},"On{PowerUpName}"),"."),(0,o.kt)("p",null,"In this case, there is a ",(0,o.kt)("inlineCode",{parentName:"p"},"OnExamplePowerUp(int what)")," method that receives a Godot notification identifier integer. SuperNodes will call the ",(0,o.kt)("inlineCode",{parentName:"p"},"OnExamplePowerUp")," method from its generated ",(0,o.kt)("inlineCode",{parentName:"p"},"_Notification")," handler whenever a Godot event occurs, allowing the PowerUp to perform actions in response to the events of whatever SuperNode it is applied to."),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"From now on, we'll refer to the ",(0,o.kt)("inlineCode",{parentName:"p"},"On{PowerUpName}")," method as the ",(0,o.kt)("inlineCode",{parentName:"p"},"OnPowerUp")," method when talking about PowerUps.")),(0,o.kt)("p",null,"PowerUps can add any kind of additional instance data (fields, properties, events, static members, etc) to a C# Godot script, bypassing the limitations of default interface implementations. But that's not all. PowerUps can also:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u2705 Add instance data, methods, and event implementations to SuperNodes."),(0,o.kt)("li",{parentName:"ul"},"\u2705 Implement interfaces on SuperNodes."),(0,o.kt)("li",{parentName:"ul"},"\u2705 Receive type parameters (generic PowerUps)!"),(0,o.kt)("li",{parentName:"ul"},"\u2705 Implement generic interfaces on SuperNodes."),(0,o.kt)("li",{parentName:"ul"},"\u2705 Inspect and manipulate all the properties and fields of a SuperNode, including the properties and fields that come from other PowerUps.")),(0,o.kt)("p",null,"We'll discuss how to take advantage of these features in your projects in the documentation that follows this article."),(0,o.kt)("h2",{id:"-beneath-the-magic"},"\ud83e\ude84 Beneath the Magic"),(0,o.kt)("p",null,"SuperNodes will generate several implementation files for ",(0,o.kt)("inlineCode",{parentName:"p"},"ExampleNode")," so that it can be magically enhanced."),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"To show generated files, you can add the following to your ",(0,o.kt)("inlineCode",{parentName:"p"},".csproj")," file:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-xml"},"<PropertyGroup>\n  <EmitCompilerGeneratedFiles>true</EmitCompilerGeneratedFiles>\n  <CompilerGeneratedFilesOutputPath>.generated</CompilerGeneratedFilesOutputPath>\n</PropertyGroup>\n"))),(0,o.kt)("p",null,"Here's what's in the main implementation file that contains the ",(0,o.kt)("inlineCode",{parentName:"p"},"_Notification")," method:"),(0,o.kt)(u,{summary:(0,o.kt)("summary",null,(0,o.kt)("code",null,"SimpleExample.ExampleNode.g.cs")),mdxType:"Details"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-csharp"},"#nullable enable\nusing Godot;\nusing SuperNodes.Types;\n\nnamespace SimpleExample {\n  partial class ExampleNode {\n    public override partial void _Notification(int what) {\n      // Invoke declared lifecycle method handlers.\n      OnExamplePowerUp(what);\n\n      // Invoke any notification handlers declared in the script.\n      switch ((long)what) {\n        case NotificationReady:\n          OnReady();\n          break;\n        case NotificationProcess:\n          OnProcess(GetProcessDeltaTime());\n          break;\n        default:\n          break;\n      }\n    }\n  }\n}\n#nullable disable\n"))),(0,o.kt)("p",null,"The generated ",(0,o.kt)("inlineCode",{parentName:"p"},"_Notification")," implementation allows the SuperNode to track the lifecycle events that occur and dispatch them to your script's lifecycle method handlers, as well as to any ",(0,o.kt)("inlineCode",{parentName:"p"},"OnPowerUp")," methods declared in the applied PowerUps."),(0,o.kt)("p",null,"SuperNodes only generates ",(0,o.kt)("inlineCode",{parentName:"p"},"switch/case")," statements for the lifecycle handlers present in your script \u2014 it doesn't generate a ",(0,o.kt)("inlineCode",{parentName:"p"},"case")," for every single Godot notification identifier. If you don't declare an ",(0,o.kt)("inlineCode",{parentName:"p"},"OnReady")," method, the ",(0,o.kt)("inlineCode",{parentName:"p"},"switch/case")," statement won't have a ",(0,o.kt)("inlineCode",{parentName:"p"},"case")," for ",(0,o.kt)("inlineCode",{parentName:"p"},"NotificationReady"),", reducing the number of jump instructions in the final binary."),(0,o.kt)("p",null,"We've barely scratched the surface of showing what's possible with SuperNodes and PowerUps. If you're having fun, keep reading to learn more!"))}f.isMDXComponent=!0},4467:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/header-bbf251851f04eefa5fd63323124240f2.jpg"}}]);
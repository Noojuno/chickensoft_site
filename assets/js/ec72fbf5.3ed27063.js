"use strict";(self.webpackChunkchickensoft_site=self.webpackChunkchickensoft_site||[]).push([[9749],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>d});var i=a(7294);function n(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,i)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){n(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,i,n=function(e,t){if(null==e)return{};var a,i,n={},o=Object.keys(e);for(i=0;i<o.length;i++)a=o[i],t.indexOf(a)>=0||(n[a]=e[a]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)a=o[i],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(n[a]=e[a])}return n}var l=i.createContext({}),s=function(e){var t=i.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},p=function(e){var t=s(e.components);return i.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},g=i.forwardRef((function(e,t){var a=e.components,n=e.mdxType,o=e.originalType,l=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),g=s(a),d=n,k=g["".concat(l,".").concat(d)]||g[d]||u[d]||o;return a?i.createElement(k,r(r({ref:t},p),{},{components:a})):i.createElement(k,r({ref:t},p))}));function d(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=a.length,r=new Array(o);r[0]=g;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:n,r[1]=c;for(var s=2;s<o;s++)r[s]=a[s];return i.createElement.apply(null,r)}return i.createElement.apply(null,a)}g.displayName="MDXCreateElement"},9749:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>c,toc:()=>s});var i=a(7462),n=(a(7294),a(3905));const o={title:"\ud83e\ude84 Tips and Tricks",image:"./header.jpg"},r=void 0,c={unversionedId:"logic_blocks/tips_and_tricks",id:"logic_blocks/tips_and_tricks",title:"\ud83e\ude84 Tips and Tricks",description:"Additional functionality and troubleshooting tips for LogicBlocks are described here.",source:"@site/docs/logic_blocks/08_tips_and_tricks.md",sourceDirName:"logic_blocks",slug:"/logic_blocks/tips_and_tricks",permalink:"/docs/logic_blocks/tips_and_tricks",draft:!1,editUrl:"https://github.com/chickensoft-games/chickensoft_site/tree/main/docs/logic_blocks/08_tips_and_tricks.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{title:"\ud83e\ude84 Tips and Tricks",image:"./header.jpg"},sidebar:"tutorialSidebar",previous:{title:"\ud83d\udcbe Serialization",permalink:"/docs/logic_blocks/serialization"},next:{title:"\ud83d\udd2e SuperNodes",permalink:"/docs/super_nodes/"}},l={image:a(1266).Z},s=[{value:"\ud83d\udd27 Manual Logic Blocks",id:"-manual-logic-blocks",level:2},{value:"\ud83d\udcd0 Generic Logic Blocks",id:"-generic-logic-blocks",level:2},{value:"\ud83e\udd2a The Naive Approach",id:"-the-naive-approach",level:3},{value:"\u2705 Generic Logic Block Fix",id:"-generic-logic-block-fix",level:3}],p={toc:s};function u(e){let{components:t,...a}=e;return(0,n.kt)("wrapper",(0,i.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"Additional functionality and troubleshooting tips for LogicBlocks are described here."),(0,n.kt)("h2",{id:"-manual-logic-blocks"},"\ud83d\udd27 Manual Logic Blocks"),(0,n.kt)("p",null,"Most examples in the documentation depict logic blocks being used alongside the ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/chickensoft-games/Introspection"},"Introspection")," generator to enable automatic state preallocation and serialization. If you do not want to leverage the generator, you can omit it and still use logic blocks."),(0,n.kt)("p",null,"To make a logic block without the generator, simply omit the ",(0,n.kt)("inlineCode",{parentName:"p"},"[Meta]")," type attribute from the logic block and its states. Be sure to manually preallocate all possible instantiable states in the logic block's constructor and add them to the blackboard, being careful not to forget any."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-csharp"},"[LogicBlock(typeof(State))]\npublic class ManualLogicBlock : LogicBlock<ManualLogicBlock.State> {\n  public abstract record State : StateLogic<State> { }\n\n  public record StateOne : State;\n  public record StateTwo : State;\n  public override Transition GetInitialState() => To<State>();\n\n  public ManualLogicBlock() {\n    // Important: we have to add an instance of each state to the blackboard\n    // to avoid errors at runtime.\n    Set(new StateOne());\n    Set(new StateTwo());\n  }\n}\n")),(0,n.kt)("h2",{id:"-generic-logic-blocks"},"\ud83d\udcd0 Generic Logic Blocks"),(0,n.kt)("p",null,"In C#, a type is generic if it accepts type parameters or is nested (however deeply) inside a type that receives generic parameters. Logic Blocks ",(0,n.kt)("strong",{parentName:"p"},"can")," be generic, but there are a few limitations to be aware of. Notably:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"\ud83d\udeab \u2728 Generic logic blocks can't be used with the introspection generator to automatically preallocate states, so you have to manually create state instances and add them to the blackboard, as shown above.")),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("p",{parentName:"li"},"\ud83d\udeab \ud83d\udcbe Generic logic blocks are not serializable. The logic block serialization mechanisms are built on top of the Chickensoft ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/chickensoft-games/Serialization"},"Serialization")," system, which itself is built on the Chickensoft ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/chickensoft-games/Introspection"},"Introspection")," library. The ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/chickensoft-games/Introspection"},"Introspection")," system does not support generic types (by design), so neither does the Chickensoft Serialization system or Logic Blocks."))),(0,n.kt)("h3",{id:"-the-naive-approach"},"\ud83e\udd2a The Naive Approach"),(0,n.kt)("p",null,"The ",(0,n.kt)("inlineCode",{parentName:"p"},"[LogicBlock]")," attribute specifies the type to be used as the logic block's state and is read at build-time by the Logic Blocks Diagram Generator so it can resolve the state hierarchy for visualization purposes. The ",(0,n.kt)("inlineCode",{parentName:"p"},"[LogicBlock]")," attribute is also used to find the state's type when ",(0,n.kt)("a",{parentName:"p",href:"https://github.com/chickensoft-games/Introspection"},"Introspection")," is being used so that the logic block can look up derived states and their metadata at runtime to preallocate states."),(0,n.kt)("admonition",{type:"danger"},(0,n.kt)("p",{parentName:"admonition"},"The following example results in a build error because ",(0,n.kt)("inlineCode",{parentName:"p"},"typeof")," expressions inside an attribute are not allowed to ",(0,n.kt)("em",{parentName:"p"},"implicitly")," reference generic types."),(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-csharp"},"// Example: nesting a logic block in a generic type\npublic class MyGenericType<T> {\n  [LogicBlock(typeof(State))] // <- Error CS0416\n  public class MyLogicBlock : LogicBlock<MyLogicBlock.State> {\n    public override Transition GetInitialState() => To<State>();\n    public record State : StateLogic<State> {}\n  }\n}\n")),(0,n.kt)("pre",{parentName:"admonition"},(0,n.kt)("code",{parentName:"pre",className:"language-txt"},"ERROR: 'MyGenericType<T>.MyLogicBlock.State': an attribute argument cannot use type parameters (CS0416)\n"))),(0,n.kt)("p",null,"Because the ",(0,n.kt)("inlineCode",{parentName:"p"},"State")," type is nested inside a generic type, it is itself a generic type (per the C# language rules), even though it might not look like it. In reality, the actual fully qualified name of the ",(0,n.kt)("inlineCode",{parentName:"p"},"State")," type is ",(0,n.kt)("inlineCode",{parentName:"p"},"MyGenericType<T>.MyLogicBlock.State"),". When depicted with its fully qualified name, it is easy to see why the ",(0,n.kt)("inlineCode",{parentName:"p"},"State")," type is secretly generic."),(0,n.kt)("p",null,"One alternative is to move the state outside the generic type, but this isn't always desirable since you won't have access to the generic types that the logic block is intended to work with."),(0,n.kt)("h3",{id:"-generic-logic-block-fix"},"\u2705 Generic Logic Block Fix"),(0,n.kt)("p",null,"To declare a generic logic block, simply specify the state type as an ",(0,n.kt)("em",{parentName:"p"},(0,n.kt)("a",{parentName:"em",href:"https://stackoverflow.com/a/2173115"},"open generic"))," type and ensure your logic block and its states do ",(0,n.kt)("em",{parentName:"p"},"not")," have the ",(0,n.kt)("inlineCode",{parentName:"p"},"[Meta]")," attribute. The diagram generator (as of version 5.10.0) is smart enough to recognize open generic state types."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-csharp"},"public class MyGenericType<T> {\n  // Fix: simply specify the state type as an open generic type\n  [LogicBlock(typeof(MyGenericType<>.MyLogicBlock.State))]\n  public class MyLogicBlock : LogicBlock<MyLogicBlock.State> {\n    public override Transition GetInitialState() => To<State>();\n    public record State : StateLogic<State> { }\n  }\n}\n")),(0,n.kt)("p",null,"Since C# doesn't like secret generic types, you have to be very specific when specifying the state type in the ",(0,n.kt)("inlineCode",{parentName:"p"},"[LogicBlock]")," attribute."),(0,n.kt)("p",null,":::"))}u.isMDXComponent=!0},1266:(e,t,a)=>{a.d(t,{Z:()=>i});const i=a.p+"assets/images/header-3b16a21d739396967ca870ae00925c8e.jpg"}}]);